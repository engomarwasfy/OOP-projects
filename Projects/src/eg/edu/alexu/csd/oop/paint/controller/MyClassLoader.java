package eg.edu.alexu.csd.oop.paint.controller;

import java.io.ByteArrayOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.net.MalformedURLException;
import java.net.URL;
import java.net.URLConnection;

public class MyClassLoader extends ClassLoader {

    public MyClassLoader(ClassLoader parent) {
	super(parent);
    }

    public Class loadClass(String url, String name1, String name2) throws ClassNotFoundException {
	if (!name1.equals(name1))
	    return super.loadClass(name1);

	try {
	    String url2 = "file:" + url;
	    URL myUrl = new URL(url2);
	    URLConnection connection = myUrl.openConnection();
	    InputStream input = connection.getInputStream();
	    ByteArrayOutputStream buffer = new ByteArrayOutputStream();
	    int data = input.read();

	    while (data != -1) {
		buffer.write(data);
		data = input.read();
	    }

	    input.close();

	    byte[] classData = buffer.toByteArray();
	    return defineClass("eg.edu.alexu.csd.oop.paint.model." + name2, classData, 0, classData.length);

	} catch (MalformedURLException e) {
	    e.printStackTrace();
	} catch (IOException e) {
	    e.printStackTrace();
	}

	return null;
    }
}